{"version":3,"file":"olcesium.js","mappings":"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","sources":["webpack://olcs_unused_var/webpack/bootstrap","webpack://olcs_unused_var/webpack/runtime/compat get default export","webpack://olcs_unused_var/webpack/runtime/define property getters","webpack://olcs_unused_var/webpack/runtime/hasOwnProperty shorthand","webpack://olcs_unused_var/webpack/runtime/make namespace object","webpack://olcs_unused_var/external var \"ol.geom.Point\"","webpack://olcs_unused_var/external var \"ol.proj\"","webpack://olcs_unused_var/./src/olcs/util.js","webpack://olcs_unused_var/external var \"ol.easing\"","webpack://olcs_unused_var/external var \"ol.layer.Tile\"","webpack://olcs_unused_var/external var \"ol.layer.Image\"","webpack://olcs_unused_var/external var \"ol.source.ImageStatic\"","webpack://olcs_unused_var/external var \"ol.source.ImageWMS\"","webpack://olcs_unused_var/external var \"ol.source.TileImage\"","webpack://olcs_unused_var/external var \"ol.source.TileWMS\"","webpack://olcs_unused_var/external var \"ol.source.VectorTile\"","webpack://olcs_unused_var/external var \"ol.source.Image\"","webpack://olcs_unused_var/external var \"ol.source\"","webpack://olcs_unused_var/./src/olcs/core/OLImageryProvider.js","webpack://olcs_unused_var/external var \"ol.format.MVT\"","webpack://olcs_unused_var/external var \"ol.style.Style\"","webpack://olcs_unused_var/external var \"ol.style.Stroke\"","webpack://olcs_unused_var/external var \"ol.render\"","webpack://olcs_unused_var/external var \"ol.util\"","webpack://olcs_unused_var/external var \"ol.structs.LRUCache\"","webpack://olcs_unused_var/external var \"ol.tilegrid\"","webpack://olcs_unused_var/external var \"ol.tileurlfunction\"","webpack://olcs_unused_var/./src/olcs/MVTImageryProvider.js","webpack://olcs_unused_var/external var \"ol.layer.VectorTile\"","webpack://olcs_unused_var/external var \"ol.extent\"","webpack://olcs_unused_var/./src/olcs/core.js","webpack://olcs_unused_var/./src/olcs/AutoRenderLoop.js","webpack://olcs_unused_var/external var \"ol.Observable\"","webpack://olcs_unused_var/./src/olcs/math.js","webpack://olcs_unused_var/./src/olcs/Camera.js","webpack://olcs_unused_var/external var \"ol.layer.Group\"","webpack://olcs_unused_var/./src/olcs/AbstractSynchronizer.js","webpack://olcs_unused_var/./src/olcs/RasterSynchronizer.js","webpack://olcs_unused_var/external var \"ol.source.Vector\"","webpack://olcs_unused_var/external var \"ol.layer.Layer\"","webpack://olcs_unused_var/external var \"ol.source.Cluster\"","webpack://olcs_unused_var/external var \"ol.layer.Vector\"","webpack://olcs_unused_var/external var \"ol.geom.Geometry\"","webpack://olcs_unused_var/external var \"ol.style.Icon\"","webpack://olcs_unused_var/external var \"ol.geom.Polygon\"","webpack://olcs_unused_var/external var \"ol.geom.SimpleGeometry\"","webpack://olcs_unused_var/./src/olcs/core/VectorLayerCounterpart.js","webpack://olcs_unused_var/./src/olcs/FeatureConverter.js","webpack://olcs_unused_var/./src/olcs/VectorSynchronizer.js","webpack://olcs_unused_var/external var \"ol.Overlay\"","webpack://olcs_unused_var/./src/olcs/SynchronizedOverlay.js","webpack://olcs_unused_var/./src/olcs/OverlaySynchronizer.js","webpack://olcs_unused_var/./src/olcs/OLCesium.js","webpack://olcs_unused_var/./src/olcs/contrib/LazyLoader.js","webpack://olcs_unused_var/./src/olcs/contrib/Manager.js","webpack://olcs_unused_var/./src/index.library.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = ol.geom.Point;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.proj;","/**\n * @module olcs.util\n */\nconst exports = {};\n\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexports.obj = function(param) {\n  return param;\n};\n\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nexports.supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nexports.imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexports.supportsImageRenderingPixelated = function() {\n  if (exports.supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    exports.supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (exports.supportsImageRenderingPixelatedResult_) {\n      exports.imageRenderingValueResult_ = tmp;\n    }\n  }\n  return exports.supportsImageRenderingPixelatedResult_;\n};\n\n\n/**\n * @return {string}\n */\nexports.imageRenderingValue = function() {\n  exports.supportsImageRenderingPixelated();\n  return exports.imageRenderingValueResult_ || '';\n};\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexports.getSourceProjection = function(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n    || source.getProjection();\n};\n\n/**\n * @param {ol.Observable} observable\n * @param {string} type\n * @param {Function} listener\n * @return {!ol.events.EventsKey}\n */\nexport function olcsListen(observable, type, listener) {\n  // See https://github.com/openlayers/openlayers/pull/8481\n  // ol.events.listen is internal so we use `on` instead.\n  // And since `on` as a convoluted API (can return an EventsKey or an array of them)\n  // we use a cast here.\n  return /** @type {!ol.events.EventsKey} */ (observable.on(type, listener));\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\n/**\n * Sort the passed array such that the relative order of equal elements is preverved.\n * See https://en.wikipedia.org/wiki/Sorting_algorithm#Stability for details.\n * @param {Array<*>} arr The array to sort (modifies original).\n * @param {!function(*, *): number} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  for (let i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort((a, b) => compareFnc(a.value, b.value) || a.index - b.index);\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  // [jrom] Check that node exists\n  while (node && node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\n/**\n * @param {Cesium.Scene} scene The scene.\n */\nexport function isGroundPolylinePrimitiveSupported(scene) {\n  const obj = Cesium.GroundPolylinePrimitive;\n  return obj && obj.isSupported(scene);\n}\n\nexport default exports;\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.easing;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.layer.Tile;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.layer.Image;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.ImageStatic;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.ImageWMS;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.TileImage;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.TileWMS;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.VectorTile;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.Image;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source;","/**\n * @module olcs.core.OLImageryProvider\n */\nimport olcsUtil from '../util.js';\nimport {Tile as TileSource} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core.js';\n\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.Map} olMap\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(olMap, source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = null;\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = olMap;\n\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_(frameState) {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = olcsUtil.getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.format.MVT;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.style.Style;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.style.Stroke;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.render;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.util;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.structs.LRUCache;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.tilegrid;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.tileurlfunction;","import MVT from 'ol/format/MVT.js';\nimport Style from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\n\n\nconst format = new MVT();\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider {\n  constructor(options) {\n    this.urls = options.urls;\n    this.ready = true;\n    this.readyPromise = Promise.resolve(true);\n    this.tileWidth = 256;\n    this.tileHeight = 256;\n    this.maximumLevel = options.maximumLevel || 20;\n    this.minimumLevel = options.minimumLevel || 0;\n    this.tilingScheme = new Cesium.WebMercatorTilingScheme;\n    this.rectangle = options.rectangle || this.tilingScheme.rectangle;\n    this.errorEvent = new Cesium.Event();\n    this.credit = options.credit;\n    this.hasAlphaChannel = true;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.projection_ = getProjection('EPSG:3857');\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n    this.tileRectangle_ = new Cesium.Rectangle();\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    // to avoid too frequent cache grooming we allow x2 capacity\n\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  getTileCredits() {\n    return [];\n  }\n\n  pickFeatures() {\n  }\n\n\n  getTileFeatures(z, x, y) {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer) {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: format.dataProjection,\n        featureProjection: format.dataProjection\n      };\n    }\n    const features = format.readFeatures(buffer, options);\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  getUrl_(z, x, y) {\n    const url = this.tileFunction_([z, x, y]);\n    return url;\n  }\n\n  getCacheKey_(z, x, y) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x, y, z, request) {\n    if (z < this.minimumLevel) {\n      return this.emptyCanvas_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      this.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features, styleFunction, resolution) {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        styles.forEach((style) => {\n          vectorContext.setStyle(style);\n          vectorContext.drawGeometry(f);\n        });\n      }\n    });\n    return canvas;\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.layer.VectorTile;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.extent;","/**\n * @module olcs.core\n */\nimport {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport olcsUtil from './util.js';\nimport MVTImageryProvider from './MVTImageryProvider.js';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {getCenter as getExtentCenter} from 'ol/extent';\n\nconst exports = {};\n\n\n/**\n * @typedef {Object} CesiumUrlDefinition\n * @property {string} url\n * @property {string} subdomains\n */\n\n\n/**\n * Options for rotate around axis core function.\n * @typedef {Object} RotateAroundAxisOption\n * @property {number} [duration]\n * @property {function(number): number} [easing]\n * @property {function(): void} [callback]\n */\n\n\n\n/**\n * @typedef {Object} LayerWithParents\n * @property {import('ol/layer/Base.js').default} layer\n * @property {Array<import('ol/layer/Group.js').default>} parents\n */\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @return {!Cesium.Cartesian2} the pixel size\n * @api\n */\nexports.computePixelSizeAtCoordinate = function(scene, target) {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight,\n      distance, scene.pixelRatio, new Cesium.Cartesian2());\n};\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexports.computeBoundingBoxAtTarget = function(scene, target, amount) {\n  const pixelSize = exports.computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n};\n\n\n/**\n *\n * @param {!ol.geom.Geometry} geometry\n * @param {number} height\n * @api\n */\nexports.applyHeightOffsetToGeometry = function(geometry, height) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n};\n\n\n/**\n * @param {ol.Coordinate} coordinates\n * @param {number=} rotation\n * @param {!Cesium.Cartesian3=} translation\n * @param {!Cesium.Cartesian3=} scale\n * @return {!Cesium.Matrix4}\n * @api\n */\nexports.createMatrixAtCoordinates = function(coordinates, rotation = 0, translation = Cesium.Cartesian3.ZERO, scale = new Cesium.Cartesian3(1, 1, 1)) {\n  const position = exports.ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n};\n\n\n/**\n * @param {!Cesium.Camera} camera\n * @param {number} angle\n * @param {!Cesium.Cartesian3} axis\n * @param {!Cesium.Matrix4} transform\n * @param {RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.rotateAroundAxis = function(camera, angle, axis, transform,\n    opt_options) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options = opt_options || {};\n  const duration = defaultValue(options.duration, 500); // ms\n  const easing = defaultValue(options.easing, linearEasing);\n  const callback = options.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} heading\n * @param {!Cesium.Cartesian3} bottomCenter\n * @param {RotateAroundAxisOption=} opt_options\n * @api\n */\nexports.setHeadingUsingBottomCenter = function(scene, heading,\n    bottomCenter, opt_options) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = exports.computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  const rotateAroundAxis = exports.rotateAroundAxis;\n  rotateAroundAxis(camera, heading, zenith, transform, opt_options);\n};\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian2} pixel\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickOnTerrainOrEllipsoid = function(scene, pixel) {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n};\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickBottomPoint = function(scene) {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return exports.pickOnTerrainOrEllipsoid(scene, bottom);\n};\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Cartesian3|undefined}\n * @api\n */\nexports.pickCenterPoint = function(scene) {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return exports.pickOnTerrainOrEllipsoid(scene, center);\n};\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n * intersection of the camera direction with the globe.\n * @param {!Cesium.Scene} scene\n * @return {number|undefined}\n * @api\n */\nexports.computeSignedTiltAngleOnGlobe = function(scene) {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = exports.signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n};\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n * @param {!Cesium.Scene} scene\n * @return {!Cesium.Ray}\n */\nexports.bottomFovRay = function(scene) {\n  const camera = scene.camera;\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n};\n\n\n/**\n * Compute the angle between two Cartesian3.\n * @param {!Cesium.Cartesian3} first\n * @param {!Cesium.Cartesian3} second\n * @param {!Cesium.Cartesian3} normal Normal to test orientation against.\n * @return {number}\n */\nexports.signedAngleBetween = function(first, second, normal) {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n};\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} pivot Point around which the camera rotates.\n * @return {number}\n * @api\n */\nexports.computeAngleToZenith = function(scene, pivot) {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  const fy = camera.frustum.fovy / 2;\n  const ray = exports.bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = exports.signedAngleBetween(normal, direction, left);\n  return a + fy;\n};\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n * @api\n */\nexports.extentToRectangle = function(extent, projection) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n};\n\n\n/**\n * @param {!ol.Map} olMap\n * @param {!ol.source.Source} source\n * @param {!ol.View} viewProj\n * @param {!ol.layer.Base} olLayer\n * @return {!Cesium.ImageryProvider}\n */\nexports.sourceToImageryProvider = function(olMap, source, viewProj, olLayer) {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n    source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (exports.isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = olcsUtil.getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (exports.isCesiumProjection(projection)) {\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle: new Cesium.Rectangle.fromDegrees(\n            source.getImageExtent()[0],\n            source.getImageExtent()[1],\n            source.getImageExtent()[2],\n            source.getImageExtent()[3]\n        )\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile) {\n    let projection = olcsUtil.getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n      // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = exports.extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|ImageStatic are currently not supported\n    return null;\n  }\n  return provider;\n};\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and static images\n * @param {!ol.Map} olMap\n * @param {!ol.layer.Base} olLayer\n * @param {!ol.proj.Projection} viewProj Projection of the view.\n * @return {?Cesium.ImageryLayer} null if not possible (or supported)\n * @api\n */\nexports.tileLayerToImageryLayer = function(olMap, olLayer, viewProj) {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n    !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = this.sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions = {};\n\n  const forcedExtent = /** @type {ol.Extent} */ (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = exports.extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n};\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n * @param {olcsx.LayerWithParents} olLayerWithParents\n * @param {!Cesium.ImageryLayer} csLayer\n * @api\n */\nexports.updateCesiumLayerProperties = function(olLayerWithParents, csLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible &= layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n};\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n * @param {ol.Coordinate} coordinate Ol3 coordinate.\n * @return {!Cesium.Cartesian3} Cesium cartesian coordinate\n * @api\n */\nexports.ol4326CoordinateToCesiumCartesian = function(coordinate) {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n};\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n * @param {Array.<!ol.Coordinate>} coordinates Ol3 coordinates.\n * @return {!Array.<Cesium.Cartesian3>} Cesium cartesian coordinates\n * @api\n */\nexports.ol4326CoordinateArrayToCsCartesians = function(coordinates) {\n  console.assert(coordinates !== null);\n  const toCartesian = exports.ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n};\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n * @param {!T} geometry\n * @param {!ol.ProjectionLike} projection\n * @return {!T}\n * @template T\n * @api\n */\nexports.olGeometryCloneTo4326 = function(geometry, projection) {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n};\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n * @param {ol.Color|CanvasGradient|CanvasPattern|string} olColor\n * @return {!Cesium.Color}\n * @api\n */\nexports.convertColorToCesium = function(olColor) {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n};\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n * @param {string} url\n * @return {!CesiumUrlDefinition}\n * @api\n */\nexports.convertUrlToCesium = function(url) {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n};\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n * @param {!ol.Map} map\n * @param {!Cesium.Scene} scene\n * @return {Promise<undefined>}\n * @api\n */\nexports.resetToNorthZenith = function(map, scene) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = exports.computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    exports.setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options = {\n      callback: () => {\n        const view = map.getView();\n        exports.normalizeView(view);\n        resolve();\n      }\n    };\n    exports.rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexports.rotateAroundBottomCenter = function(scene, angle) {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = exports.pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options = {callback: resolve};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const rotateAroundAxis = exports.rotateAroundAxis;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n};\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n * @param {ol.View} view\n * @param {number=} angle\n * @api\n */\nexports.normalizeView = function(view, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n  if (view.constrainResolution) {\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n};\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n *\n * @param {ol.proj.Projection} projection Projection to check.\n * @returns {boolean} Whether it's managed by Cesium.\n */\nexports.isCesiumProjection = function(projection) {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n};\n\n\nexport function attributionsFunctionToCredits(attributionsFunction, zoom, center, extent) {\n  const frameState = {\n    viewState: {zoom, center},\n    extent,\n  };\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction(frameState);\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\nexport default exports;\n\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n * @param {number} resolution Number of map units per pixel.\n * @param {number} latitude Latitude in radians.\n * @param {import('cesium').Scene} scene.\n * @param {import('ol/proj/Projection').default} projection View projection.\n * @return {number} The calculated distance.\n * @api\n */\nexport function calcDistanceForResolution(resolution, latitude, scene, projection) {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n * @param {number} distance\n * @param {number} latitude\n * @param {import('cesium').Scene} scene.\n * @param {import('ol/proj/Projection').default} projection View projection.\n * @return {number} The calculated resolution.\n * @api\n */\nexport function calcResolutionForDistance(distance, latitude, scene, projection) {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.Observable;","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsCore, {calcDistanceForResolution, calcResolutionForDistance} from './core.js';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = olcsCore.pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n\n\nexport default Camera;\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.layer.Group;","/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {olcsListen, getUid} from './util.js';\n\n\nclass AbstractSynchronizer {\n  /**\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @template T\n   * @abstract\n   * @api\n   */\n  constructor(map, scene) {\n    /**\n     * @type {!ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.View}\n     * @protected\n     */\n    this.view = map.getView();\n\n    /**\n     * @type {!Cesium.Scene}\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * @type {ol.Collection.<ol.layer.Base>}\n     * @protected\n     */\n    this.olLayers = map.getLayerGroup().getLayers();\n\n    /**\n     * @type {ol.layer.Group}\n     */\n    this.mapLayerGroup = map.getLayerGroup();\n\n    /**\n     * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n     * Null value means, that we are unable to create equivalent layers.\n     * @type {Object.<string, ?Array.<T>>}\n     * @protected\n     */\n    this.layerMap = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer layers ids (from getUid).\n     * @type {!Object.<string, Array<ol.EventsKey>>}\n     * @protected\n     */\n    this.olLayerListenKeys = {};\n\n    /**\n     * Map of listen keys for OpenLayers layer groups ids (from getUid).\n     * @type {!Object.<string, !Array.<ol.EventsKey>>}\n     * @private\n     */\n    this.olGroupListenKeys_ = {};\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   * @api\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @protected\n   */\n  orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  addLayers_(root) {\n    /** @type {Array<import('olsc/core.js').LayerWithParents>} */\n    const fifo = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof olLayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = (e) => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   * @param {Array.<T>} cesiumObjects\n   * @param {string} layerId\n   * @param {ol.layer.Base} layer\n   * @private\n   */\n  addCesiumObjects_(cesiumObjects, layerId, layer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   * @private\n   */\n  removeAndDestroySingleLayer_(layer) {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  unlistenSingleGroup_(group) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   * @param {ol.layer.Base} root\n   * @private\n   */\n  removeLayer_(root) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof olLayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   * @param {ol.layer.Group} group\n   * @private\n   */\n  listenForGroupChanges_(group) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   * @protected\n   */\n  destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  addCesiumObject(object) {}\n\n  /**\n   * @param {!T} object\n   * @abstract\n   * @protected\n   */\n  destroyCesiumObject(object) {}\n\n  /**\n   * Remove single Cesium object from the collection.\n   * @param {!T} object\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeSingleCesiumObject(object, destroy) {}\n\n  /**\n   * Remove all Cesium objects from the collection.\n   * @param {boolean} destroy\n   * @abstract\n   * @protected\n   */\n  removeAllCesiumObjects(destroy) {}\n\n  /**\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @return {?Array.<T>}\n   * @abstract\n   * @protected\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {}\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport olLayerGroup from 'ol/layer/Group.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsCore from './core.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @constructor\n   * @extends {olcsAbstractSynchronizer.<Cesium.ImageryLayer>}\n   * @api\n   */\n  constructor(map, scene) {\n    super(map, scene);\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.cesiumLayers_ = scene.imageryLayers;\n\n    /**\n     * @type {!Cesium.ImageryLayerCollection}\n     * @private\n     */\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(object) {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   * @param {!ol.layer.Base} olLayer\n   * @param {!ol.proj.Projection} viewProj Projection of the view.\n   * @return {?Array.<!Cesium.ImageryLayer>} array or null if not possible\n   * (or supported)\n   * @protected\n   */\n  convertLayerToCesiumImageries(olLayer, viewProj) {\n    const result = olcsCore.tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer.getStyleFunction) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            if (csObj._imageryCache && csObj.imageryProvider.cache_) {\n              csObj._imageryCache = {};\n              csObj.imageryProvider.cache_ = {};\n              csObj.imageryProvider.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        olcsCore.updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices = {};\n    const queue = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof olLayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  /**\n   * @param {Cesium.ImageryLayer} counterpart\n   */\n  raiseToTop(counterpart) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.Vector;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.layer.Layer;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.source.Cluster;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.layer.Vector;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.geom.Geometry;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.style.Icon;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.geom.Polygon;","const __WEBPACK_NAMESPACE_OBJECT__ = ol.geom.SimpleGeometry;","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Context for feature conversion.\n * @typedef {Object} OlFeatureToCesiumContext\n * @property {!(import('ol/Projection.js').default|string)} projection\n * @property {!Cesium.PrimitiveCollection} primitives\n * @property {Object<number, Array<!Cesium.Primitive|!Cesium.Billboard>>} featureToCesiumMap\n * @property {!Cesium.BillboardCollection} billboards\n */\n\n\nclass VectorLayerCounterpart {\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  * @param {!(ol.proj.Projection|string)} layerProjection\n  * @param {!Cesium.Scene} scene\n  */\n  constructor(layerProjection, scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n\n    /**\n    * @type {!Array.<ol.EventsKey>}\n    */\n    this.olListenKeys = [];\n\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    /**\n    * @type {!OlFeatureToCesiumContext}\n    */\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  /**\n  * @return {!Cesium.Primitive}\n  */\n  getRootPrimitive() {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport olcsCore from './core.js';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.js';\nimport olcsUtil, {getUid, isGroundPolylinePrimitiveSupported} from './util.js';\n\n\n/**\n * @typedef {Object} ModelStyle\n * @property {Cesium.Matrix4} [debugModelMatrix]\n * @property {Cesium.ModelFromGltfOptions} cesiumOptions\n */\n\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.PerInstanceColorAppearance(options);\n    }\n\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return olcsCore.convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n    point = olcsCore.ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          outlinePrimitive.readyPromise.then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        outlinePrimitive.readyPromise.then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.getGeometry().get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = olcsCore.ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            outlinePrimitive.readyPromise.then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = olcsCore.ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      });\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2((image.width / 2 - anchor[0]) * scale, (image.height / 2 - anchor[1]) * scale);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = olcsUtil.obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = olcsUtil.obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olcsCore.olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        const model = Cesium.Model.fromGltf(options);\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        modelPrimitive.add(model);\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = olcsCore.ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = olcsCore.convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer.js';\nimport olcsFeatureConverter from './FeatureConverter.js';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer {\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   * @param {!ol.Map} map\n   * @param {!Cesium.Scene} scene\n   * @param {olcs.FeatureConverter=} opt_converter\n   * @extends {olcs.AbstractSynchronizer.<olcs.core.VectorLayerCounterpart>}\n   * @api\n   */\n  constructor(map, scene, opt_converter) {\n    super(map, scene);\n\n    /**\n     * @protected\n     */\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n\n    /**\n     * @private\n     */\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  addCesiumObject(counterpart) {\n    console.assert(counterpart);\n    counterpart.getRootPrimitive()['counterpart'] = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  /**\n   * @inheritDoc\n   */\n  destroyCesiumObject(object) {\n    object.getRootPrimitive().destroy();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeSingleCesiumObject(object, destroy) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  removeAllCesiumObjects(destroy) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   * @param {import('olsc/core.js').LayerWithParents} olLayerWithParents\n   * @param {!Cesium.Primitive} csPrimitive\n   */\n  updateLayerVisibility(olLayerWithParents, csPrimitive) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible &= layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  createSingleLayerCounterparts(olLayerWithParents) {\n    const olLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap = {};\n    const counterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature) {\n      console.assert(\n          (olLayer instanceof olLayerVector) ||\n          (olLayer instanceof olLayerImage)\n      );\n      const context = counterpart.context;\n      const prim = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature) {\n      const id = getUid(feature);\n      const context = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }, this));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }, this));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","const __WEBPACK_NAMESPACE_OBJECT__ = ol.Overlay;","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Options for SynchronizedOverlay\n * @typedef {Object} SynchronizedOverlayOptions\n * @property {!Cesium.Scene} scene\n * @property {olOverlay} parent\n * @property {!import('olsc/OverlaySynchronizer.js').default} synchronizer\n */\n\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (node.nodeName === 'CANVAS') {\n        const ctx = clone.getContext('2d');\n        ctx.drawImage(node, 0, 0);\n      }\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          // [jrom] Check if this.element exist\n          if (this.element) {\n            this.element.appendChild(clonedNode);\n          }\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(overlay); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {getTransform} from 'ol/proj.js';\nimport olcsUtil from './util.js';\nimport olcsCore from './core.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer.js';\nimport olcsVectorSynchronizer from './VectorSynchronizer.js';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\n\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\n\n\nclass OLCesium {\n  /**\n   * @param {!OLCesiumOptions} options Options.\n   * @constructor\n   * @api\n   */\n  constructor(options) {\n\n    /**\n     * @type {olcs.AutoRenderLoop}\n     * @private\n     */\n    this.autoRenderLoop_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = options.map;\n\n    /**\n     * @type {!function(): Cesium.JulianDate}\n     * @private\n     */\n    this.time_ = options.time || function() {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     * @private\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.resolutionScale_ = 1.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientWidth_ = 0.0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.canvasClientHeight_ = 0.0;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.resolutionScaleChanged_ = true; // force resize\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;';\n\n    /**\n     * @type {!Element}\n     * @private\n     */\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     * @type {boolean}\n     * @private\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'MSPointerDown', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n\n    /**\n     * @type {!HTMLCanvasElement}\n     * @private\n     */\n    this.canvas_ = /** @type {!HTMLCanvasElement} */ (document.createElement('CANVAS'));\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (olcsUtil.supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = olcsUtil.imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function() { return false; };\n    this.canvas_.onselectstart = function() { return false; };\n\n    this.container_.appendChild(this.canvas_);\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.enabled_ = false;\n\n    /**\n     * @type {!Array.<ol.interaction.Interaction>}\n     * @private\n     */\n    this.pausedInteractions_ = [];\n\n    /**\n     * @type {?ol.layer.Group}\n     * @private\n     */\n    this.hiddenRootGroup_ = null;\n\n    const sceneOptions = options.sceneOptions !== undefined ? options.sceneOptions :\n      /** @type {Cesium.SceneOptions} */ ({});\n    sceneOptions.canvas = this.canvas_;\n    sceneOptions.scene3DOnly = true;\n\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.SHIFT\n    });\n\n    sscc.tiltEventTypes.push({\n      'eventType': Cesium.CameraEventType.LEFT_DRAG,\n      'modifier': Cesium.KeyboardEventModifier.ALT\n    });\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    /**\n     * @type {!olcs.Camera}\n     * @private\n     */\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    /**\n     * @type {!Cesium.Globe}\n     * @private\n     */\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    const synchronizers = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = synchronizers.length - 1; i >= 0; --i) {\n      synchronizers[i].synchronize();\n    }\n\n    /**\n     * Time of the last rendered frame, as returned by `performance.now()`.\n     * @type {number}\n     * @private\n     */\n    this.lastFrameTime_ = 0;\n\n    /**\n     * The identifier returned by `requestAnimationFrame`.\n     * @type {number|undefined}\n     * @private\n     */\n    this.renderId_ = undefined;\n\n    /**\n     * Target frame rate for the render loop.\n     * @type {number}\n     * @private\n     */\n    this.targetFrameRate_ = Number.POSITIVE_INFINITY;\n\n    /**\n     * If the Cesium render loop is being blocked.\n     * @type {boolean}\n     * @private\n     */\n    this.blockCesiumRendering_ = false;\n\n    /**\n     * If the warmup routine is active.\n     * @type {boolean}\n     * @private\n     */\n    this.warmingUp_ = false;\n\n    /**\n     * @type {ol.Feature}\n     * @private\n     */\n    this.trackedFeature_ = null;\n\n    /**\n     * @type {Cesium.Entity}\n     * @private\n     */\n    this.trackedEntity_ = null;\n\n    /**\n     * @type {Cesium.EntityView}\n     * @private\n     */\n    this.entityView_ = null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.needTrackedEntityUpdate_ = false;\n\n    /**\n     * @type {!Cesium.BoundingSphere}\n     */\n    this.boundingSphereScratch_ = new Cesium.BoundingSphere();\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n\n    // Cesium has a mechanism to prevent the camera to go under the terrain.\n    // Unfortunately, it is only active when all the terrain has been loaded, which:\n    // - does not prevent the camera to sink under terrain anymore;\n    // - introduce a jumping effect once all terrain has been loaded and the position of the camera is finally fixed.\n    // The property below enables a workaround found in the Camptocamp Cesium fork.\n    // See also https://github.com/AnalyticalGraphicsInc/cesium/issues/5999.\n    Cesium.Camera.enableSuspendTerrainAdjustment = false;\n  }\n\n  /**\n   * Render the Cesium scene.\n   * @private\n   */\n  render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   * @private\n   */\n  onAnimationFrame_(frameTime) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === Cesium.BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  /**\n   * @private\n   */\n  updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === Cesium.BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== Cesium.BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  /**\n   * @private\n   */\n  handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 | height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!olcsUtil.supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    this.scene_.camera.frustum.aspectRatio = width / height;\n  }\n\n  /**\n   * @return {!olcs.Camera}\n   * @api\n   */\n  getCamera() {\n    return this.camera_;\n  }\n\n  /**\n   * @return {!ol.Map}\n   * @api\n   */\n  getOlMap() {\n    return this.map_;\n  }\n\n  /**\n   * @return {!ol.View}\n   * @api\n   */\n  getOlView() {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @return {!Cesium.Scene}\n   * @api\n   */\n  getCesiumScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceCollection}\n   * @api\n   */\n  getDataSources() {\n    return this.dataSourceCollection_;\n  }\n\n  /**\n   * @return {!Cesium.DataSourceDisplay}\n   * @api\n   */\n  getDataSourceDisplay() {\n    return this.dataSourceDisplay_;\n  }\n\n  /**\n   * @return {boolean}\n   * @api\n   */\n  getEnabled() {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   * @param {boolean} enable\n   * @api\n   */\n  setEnabled(enable) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = interaction =>\n          this.pausedInteractions_ = this.pausedInteractions_.filter(i => i !== interaction);\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n   * @api\n  */\n  warmUp(height, timeout) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n   * @api\n  */\n  setBlockCesiumRendering(block) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   * @api\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n   * @return {?olcs.AutoRenderLoop}\n   * @api\n  */\n  getAutoRenderLoop() {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   *\n   * @param {number} value\n   * @this {olcs.OLCesium}\n   * @api\n   */\n  setResolutionScale(value) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   * @api\n   */\n  setTargetFrameRate(value) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   * @private\n   */\n  throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  /**\n   * @type {ol.Feature}\n   */\n  get trackedFeature() {\n    return this.trackedFeature_;\n  }\n\n  /**\n   * @param {ol.Feature} feature\n   */\n  set trackedFeature(feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry.getCoordinates();\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return olcsCore.ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independant from the primitive/geometry created by the vector synchronizer.\n      const options = {\n        'position': new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        'point': {\n          'pixelSize': 1,\n          'color': Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n\nexport default OLCesium;\n","/**\n * @module olcs.contrib.LazyLoader\n */\nexport default class LazyLoader {\n  /**\n   * @param {string} url\n   * @api\n   */\n  constructor(url) {\n    /**\n     * @type {Promise<undefined>}\n     * @protected\n     */\n    this.promise;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = url;\n  }\n\n  /**\n   * @return {Promise<undefined>}\n   * @api\n   */\n  load() {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n","/**\n * @module olcs.contrib.Manager\n */\nimport olcsContribLazyLoader from '../contrib/LazyLoader.js';\nimport OLCesium from '../OLCesium.js';\nimport olcsCore from '../core.js';\nimport {toRadians} from '../math.js';\nimport olObservable from 'ol/Observable.js';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nconst Manager = class extends olObservable {\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken} = {}) {\n\n    super();\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumUrl_ = cesiumUrl;\n\n    /**\n     * @type {ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.Extent}\n     * @protected\n     */\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n\n    /**\n     * @private\n     * @type {Cesium.BoundingSphere}\n     */\n    this.boundingSphere_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.blockLimiter_ = false;\n\n    /**\n     * @type {Promise.<olcs.OLCesium>}\n     * @private\n     */\n    this.promise_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n\n    /**\n     * @type {olcs.OLCesium}\n     * @protected\n     */\n    this.ol3d;\n\n    /**\n     * @const {number} Tilt angle in radians\n     * @private\n     */\n    this.cesiumInitialTilt_ = toRadians(50);\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogDensity = 0.0001;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogSSEFactor = 25;\n\n    /**\n     * Limit the minimum distance to the terrain to 2m.\n     * @protected\n     * @type {number}\n     */\n    this.minimumZoomDistance = 2;\n\n    /**\n     * Limit the maximum distance to the earth to 10'000km.\n     * @protected\n     * @type {number}\n     */\n    this.maximumZoomDistance = 10000000;\n\n    // when closer to 3000m, restrict the available positions harder\n    /**\n     * @protected\n     * @param {number} height\n     */\n    this.limitCameraToBoundingSphereRatio = height => (height > 3000 ? 9 : 3);\n  }\n\n\n  /**\n   * @return {Promise.<olcs.OLCesium>}\n   */\n  load() {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * @protected\n   * @return {olcs.OLCesium}\n   */\n  onCesiumLoaded() {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   * @return {olcs.OLCesium}\n   */\n  instantiateOLCesium() {\n    console.assert(this.map);\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    const terrainProvider = Cesium.createWorldTerrain();\n    scene.terrainProvider = terrainProvider;\n    return ol3d;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForPerformance(scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForUsability(scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this), scene);\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   * @protected\n   */\n  limitCameraToBoundingSphere() {\n    if (this.boundingSphere_ && !this.blockLimiter_) {\n      const scene = this.ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      const ratio = this.limitCameraToBoundingSphereRatio(carto.height);\n      if (Cesium.Cartesian3.distance(this.boundingSphere_.center, position) > this.boundingSphere_.radius * ratio) {\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          this.blockLimiter_ = true;\n          const unblockLimiter = () => this.blockLimiter_ = false;\n          camera.flyToBoundingSphere(this.boundingSphere_, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter\n          });\n        }\n      }\n    }\n  }\n\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   * @export\n   * @return {Promise<undefined>}\n   */\n  toggle3d() {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return olcsCore.resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return olcsCore.rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   *\n   * @export\n   * @param {number} lon\n   * @param {number} lat\n   * @param {number} elevation\n   * @param {number} headingDeg Heading value in degrees.\n   * @param {number} pitchDeg Pitch value in degrees.\n   * @returns {Promise<undefined>}\n   */\n  set3dWithView(lon, lat, elevation, headingDeg, pitchDeg) {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * @export\n   * @return {boolean}\n   */\n  is3dEnabled() {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading() {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = olcsCore.computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * @param {number} angle\n   */\n  setHeading(angle) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = olcsCore.pickBottomPoint(scene);\n    if (bottom) {\n      olcsCore.setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  /**\n   * @export\n   * @return {olcs.OLCesium}\n   */\n  getOl3d() {\n    return this.ol3d;\n  }\n\n  /**\n   * @export\n   * @return {!ol.View}\n   */\n  getOlView() {\n    const view = this.map.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @export\n   * @return {Cesium.Matrix4}\n   */\n  getCesiumViewMatrix() {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  /**\n   * @export\n   * @return {!Cesium.Scene}\n   */\n  getCesiumScene() {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * @export\n   * @param {!Cesium.Rectangle} rectangle\n   * @param {number=} offset in meters\n   * @return {Promise<undefined>}\n   */\n  flyToRectangle(rectangle, offset = 0) {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n\n  /**\n   * @protected\n   * @return {Cesium.Rectangle|undefined}\n   */\n  getCameraExtentRectangle() {\n    if (this.cameraExtentInRadians) {\n      return new Cesium.Rectangle(...this.cameraExtentInRadians);\n    }\n  }\n};\n\n\nexport default Manager;\n","import OLCesium from './olcs/OLCesium.js';\n\nimport AbstractSynchronizer from './olcs/AbstractSynchronizer.js';\nimport RasterSynchronizer from './olcs/RasterSynchronizer.js';\nimport VectorSynchronizer from './olcs/VectorSynchronizer.js';\n\nimport * as core from './olcs/core.js';\nimport OLImageryProvider from './olcs/core/OLImageryProvider.js';\nimport VectorLayerCounterpart from './olcs/core/VectorLayerCounterpart.js';\n\nimport LazyLoader from './olcs/contrib/LazyLoader.js';\nimport Manager from './olcs/contrib/Manager.js';\n\n\nexport default OLCesium;\n\n// Using var for phantomJS\n// eslint-disable-next-line no-var\nvar olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nolcs.core = core.default;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nolcs.contrib.LazyLoader = LazyLoader;\nolcs.contrib.Manager = Manager;\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","ol","geom","Point","proj","olcsListen","observable","type","listener","on","param","supportsImageRenderingPixelatedResult_","undefined","imageRenderingValueResult_","supportsImageRenderingPixelated","canvas","document","createElement","setAttribute","tmp","style","imageRenderingValue","getSourceProjection","source","getProjection","uidCounter_","getUid","olcs_uid","isGroundPolylinePrimitiveSupported","scene","Cesium","GroundPolylinePrimitive","isSupported","easing","layer","Tile","Image","ImageStatic","ImageWMS","TileImage","TileWMS","VectorTile","tileCoord","olUseNewCoordinates","TileSource","projection","wrapX","getTileCoordForTileUrlFunction","OLImageryProvider","olMap","opt_fallbackProj","this","source_","projection_","fallbackProj_","ready_","tilingScheme_","rectangle_","map_","shouldRequestNextLevel","proxy","proxy_","DefaultProxy","errorEvent_","Event","emptyCanvas_","width","height","e","handleSourceChanged_","frameState","getState","olcsUtil","options","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","tileGrid","forEachTileCoord","getExtent","xIndex","yIndex","getCode","GeographicTilingScheme","WebMercatorTilingScheme","rectangle","getTileCredits","x","y","level","attributionsFunction","getAttributions","extent","getView","calculateExtent","getSize","center","getCenter","attributionsFunctionToCredits","requestImage","tileUrlFunction","getTileUrlFunction","z_","y_","url","getURL","ImageryProvider","loadImage","defineProperties","tg","getTileGrid","Array","isArray","getTileSize","getMaxZoom","format","MVT","Style","Stroke","render","util","structs","LRUCache","tilegrid","tileurlfunction","styles","stroke","color","MVTImageryProvider","urls","ready","readyPromise","Promise","resolve","tileWidth","tileHeight","maximumLevel","minimumLevel","tilingScheme","errorEvent","credit","hasAlphaChannel","styleFunction_","styleFunction","tileRectangle_","Rectangle","cacheSize","tileCache","featureCache","getTilegridForProjection","tileFunction_","createTileUrlFunctions","pickFeatures","getTileFeatures","z","promise","cacheKey","getCacheKey_","containsKey","getUrl_","fetch","then","r","ok","reject","arrayBuffer","buffer","readFeaturesFromBuffer","set","getCount","highWaterMark","canExpireCache","pop","OL_VERSION","dataProjection","featureProjection","features","readFeatures","scaleFactor","forEach","f","flatCoordinates","getFlatCoordinates","flip","i","length","request","tileXYToNativeRectangle","resolution","east","west","rasterizeFeatures","raiseEvent","vectorContext","toContext","getContext","size","setStyle","drawGeometry","zoom","attributions","viewState","map","html","Credit","computePixelSizeAtCoordinate","target","camera","frustum","distance","Cartesian3","magnitude","subtract","position","getPixelDimensions","clientWidth","clientHeight","pixelRatio","Cartesian2","computeBoundingBoxAtTarget","amount","pixelSize","transform","Transforms","eastNorthUpToFixedFrame","bottomLeft","Matrix4","multiplyByPoint","topRight","Ellipsoid","WGS84","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","geometry","applyTransform","input","output","stride","createMatrixAtCoordinates","coordinates","rotation","translation","scale","ZERO","ol4326CoordinateToCesiumCartesian","rawMatrix","quaternion","Quaternion","fromAxisAngle","UNIT_Z","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","angle","axis","opt_options","clamp","Math","defaultValue","duration","linearEasing","callback","lastProgress","oldTransform","start","Date","now","window","requestAnimationFrame","step","timestamp","progress","clone","stepAngle","lookAtTransform","rotate","setHeadingUsingBottomCenter","heading","bottomCenter","angleToZenith","computeAngleToZenith","right","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","add","fromTranslation","pickOnTerrainOrEllipsoid","pixel","ray","getPickRay","globe","pick","pickEllipsoid","pickBottomPoint","bottom","pickCenterPoint","computeSignedTiltAngleOnGlobe","Ray","direction","ellipsoid","IntersectionTests","rayEllipsoid","getPoint","normal","geocentricSurfaceNormal","angleBetween","signedAngleBetween","PI","convertLongitudeRange","bottomFovRay","fovy2","fovy","matrix","first","second","b","c","normalize","cross","cosine","dot","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","transformExtent","fromDegrees","sourceToImageryProvider","viewProj","olLayer","skip","provider","olSourceImageWMS","getUrl","getImageLoadFunction","defaultImageLoadFunction","sourceProps","olSourceTileWMS","params","getParams","setProperties","olSourceTileImage","isCesiumProjection","olcsCoreOLImageryProvider","olSourceImageStatic","olSourceVectorTile","fromCode","split","u","replace","getStyleFunction","getExtentCenter","SingleTileImageryProvider","getImageExtent","tileLayerToImageryLayer","olLayerTile","olLayerImage","VectorTileLayer","getSource","layerOptions","ImageryLayer","updateCesiumLayerProperties","olLayerWithParents","csLayer","opacity","visible","concat","parents","layerOpacity","getOpacity","layerVisible","getVisible","alpha","show","coordinate","coo","ol4326CoordinateArrayToCsCartesians","toCartesian","cartesians","push","olGeometryCloneTo4326","proj4326","properties","getProperties","convertColorToCesium","olColor","Color","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","ctx","fillStyle","fillRect","ImageMaterialProperty","image","convertUrlToCesium","subdomains","re","match","exec","charCode","startCharCode","charCodeAt","stopCharCode","String","fromCharCode","resetToNorthZenith","currentHeading","getRotation","view","normalizeView","rotateAroundBottomCenter","getResolution","setRotation","constrainResolution","setResolution","getConstrainedResolution","is3857","is4326","ol3d","scene_","getCesiumScene","canvas_","_boundNotifyRepaintRequired","notifyRepaintRequired","bind","repaintEventNames_","enable","requestRenderMode","maximumRenderTimeChange","repaintKey","addEventListener","getOlMap","getLayerGroup","disable","removeEventListener","un","restartRenderLoop","requestRender","Observable","toDegrees","angleInRadians","toRadians","angleInDegrees","cam_","view_","viewListenKey_","toLonLat_","Camera","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","opt_output","opt_dimension","dim","olObservableUnByKey","toLonLat","getTransform","fromLonLat","handleViewEvent_","readFromView","setHeading","getHeading","setTilt","tilt","updateCamera_","getTilt","setDistance","updateView","getDistance","setCenter","setPosition","ll","carto","Cartographic","getAltitude","setView","destination","cartographicToCartesian","getPosition","cartesianToCartographic","longitude","latitude","setAltitude","altitude","getHeight","orientation","pitch","PI_OVER_TWO","roll","moveBackward","checkCameraChange","calcDistanceForResolution","olcsCore","bestTarget","positionCartographic","bestTargetCartographic","calcResolutionForDistance","pos","targetNormal","targetToCamera","up","tiltAngle","acos","isNaN","opt_dontSync","old","current","viewMatrix","equalsEpsilon","metersPerUnit","getMetersPerUnit","cos","abs","tan","Group","olLayers","getLayers","mapLayerGroup","layerMap","olLayerListenKeys","olGroupListenKeys_","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","splice","olLayerId","toString","cesiumObjects","olLayerGroup","listenForGroupChanges_","createSingleLayerCounterparts","l","newOlLayerWithParents","layerId","layerWithParents","onLayerChange","cesiumObjs","addCesiumObjects_","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","removeLayer_","done","uuid","listenKeyArray","contentKeys","listenAddRemove","collection","event","element","el","indexOf","objKey","removeAllCesiumObjects","object","destroy","cesiumLayers_","imageryLayers","ourLayers_","ImageryLayerCollection","remove","removeAll","convertLayerToCesiumImageries","result","olLayerItem","previousStyleFunction","currentStyleFunction","csObj","_imageryCache","imageryProvider","cache_","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","arr","compareFnc","index","sort","stableSort","layer1","layer2","raiseToTop","olcsAbstractSynchronizer","Vector","Layer","Cluster","Geometry","Icon","Polygon","SimpleGeometry","layerProjection","billboards","BillboardCollection","primitives","PrimitiveCollection","olListenKeys","rootCollection_","context","featureToCesiumMap","getRootPrimitive","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","evt","cancellers","feature","id","canceller","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","opt_lineWidth","flat","renderState","depthTest","enabled","lineWidth","instances","instance","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","createInstance","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","constructor","GroundPrimitive","geometryInstances","Primitive","dataUri","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","uniforms","PerInstanceColorAppearance","extractColorFromOlStyle","outline","fillColor","getFill","getColor","strokeColor","getStroke","extractLineWidthFromOlStyle","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","p1","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","bbOptions","eyeOffset","bb","olCircleGeometryToCesium","point","slice","getRadius","outlinePrimitive","radius","CircleGeometry","circlePolygon","olCreateCircularPolygon","positions","getLinearRing","getCoordinates","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","_primitive","createStackedGroundCorridors","CircleOutlineGeometry","extrudedHeight","max","previousDistance","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","linePositions","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","heightReference","primitiveOptions","PolylineGeometry","olPolygonGeometryToCesium","getGeometry","boundingExtent","maxHeight","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","olPos","holes","PolygonGeometry","perPositionHeight","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","olStyleIcon","load","getImage","reallyCreateBillboard","HTMLCanvasElement","HTMLImageElement","getScale","assign","anchor","getAnchor","pixelOffset","src","naturalHeight","naturalWidth","complete","isImageLoaded","cancelled","fuid","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","cesiumOptions","model","Model","fromGltf","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","subgeos","accumulate","geometries","functor","getType","getPoints","getLineStrings","getPolygons","labels","LabelCollection","extentCenter","olGeomSimpleGeometry","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","font","getFont","horizontalOrigin","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getGeometryFromFeature","opt_geom","geom3d","olGeomGeometry","geomFuncRes","getGeometryFunction","olFeatureToCesium","newBillboardAddedCallback","featureBb","getGeometries","prims","bbs","result2","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","olSourceCluster","getFeatures","olcsCoreVectorLayerCounterpart","layerStyle","prim","convert","opt_converter","converter","olcsFeatureConverter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","olLayerVector","olLayerVectorTile","csPrimitives","onAddFeature","onRemoveFeature","Billboard","Overlay","parent","getOptions","scenePostRenderListenerRemover_","synchronizer_","synchronizer","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","getScene","parentNode","removeChild","postRender","updatePixelPosition","container","stopEvent","getOverlayContainerStopEvent","getOverlayContainer","insertFirst","insertBefore","appendChild","handlePositionChanged","sourceProjection","getMap","cloneNode","nodeName","drawImage","Node","TEXT_NODE","dispatchEvent","MouseEvent","stopPropagation","nodes","lastChild","removeChildren","getElement","clonedNode","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","BoundingSphere","Occluder","isPointVisible","computeCullingVolume","computeVisibility","setVisible","pixelCartesian","cartesianToCanvasCoordinates","mapSize","updateRenderedPosition","removeNode","olOverlay","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","olcsSynchronizedOverlay","overlayId","removedOverlay","removeOverlay","csOverlay","keys","autoRenderLoop_","time_","time","JulianDate","to4326Transform_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","fillArea","container_","containerAttribute","createAttribute","setAttributeNode","targetElement","getViewport","getElementById","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","canvasAttribute","oncontextmenu","onselectstart","enabled_","pausedInteractions_","hiddenRootGroup_","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","camera_","olcsCamera","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers","createSynchronizers","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","handleResize_","lastFrameTime_","renderId_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","EventHelper","OLCesium","updateTrackedEntity_","enableSuspendTerrainAdjustment","render_","cancelAnimationFrame","onAnimationFrame_","frameTime","interval","julianDate","initializeFrame","update","trackedEntity","getBoundingSphere","BoundingSphereState","DONE","state","PENDING","enableTilt","bs","FAILED","EntityView","mapProjection","resolutionScale","devicePixelRatio","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","interactions","visibility","throwOnUnitializedMap_","getInteractions","clear","addInteraction","interaction","removeInteraction","filter","rootGroup","classList","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","olcsAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","defaultDataSource","entities","IDENTITY","to4326Transform","CallbackProperty","coo4326","TRANSPARENT","LazyLoader","url_","script","onload","onerror","head","cesiumUrl","cameraExtentInRadians","cesiumIonDefaultAccessToken","cesiumUrl_","boundingSphere_","blockLimiter_","promise_","cesiumIonDefaultAccessToken_","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumLazyLoader","olcsContribLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","fromRectangle3D","Ion","defaultAccessToken","instantiateOLCesium","configureForUsability","configureForPerformance","terrainProvider","createWorldTerrain","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","limitCameraToBoundingSphere","fromCartesian","ratio","flying","unblockLimiter","flyToBoundingSphere","cancel","toggle3d","is3DCurrentlyEnabled","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","multiplyByScalar","flyTo","endTransform","getCameraExtentRectangle","olObservable","olcs","AbstractSynchronizer","RasterSynchronizer","VectorSynchronizer","core","VectorLayerCounterpart","contrib","Manager"],"sourceRoot":""}